<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard</title>
</head>
<body>
    <h1>Leaderboard</h1>
    <ul id="leaderboard"></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>

      <script>
        
        // getting data

        let wrapper = async()=>{
                            const response =await  fetch("http://localhost:3000/getLeaderboard", {
                                method: "GET",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                            });
                            
                                        if (response.ok) {
                                            const data = await response.json();
                                           console.log(data.leaderboard)
                                           updateLeaderboard(data.leaderboard)
                                        } else {
                                            console.error("Server response was not OK");
                                        }

            }
  
            wrapper()
        const socket = io();

        // Update leaderboard function
        const updateLeaderboard = (data) => {
            data.sort((a, b) => {
                if (a.score === b.score) {
                    a.time = new Date(a.time).getTime();
                    b.time = new Date(b.time).getTime();
                    return a.time -  b.time; // If scores are equal, sort by submission time
                }
                return b.score - a.score; // Sort by score
            });
            const leaderboardElement = document.getElementById('leaderboard');
            leaderboardElement.innerHTML = '';
            data.forEach((entry, index) => {
                const li = document.createElement('li');
                time = entry.time
                date = new Date(time)
                let t = date.toLocaleTimeString();

                li.textContent = `Team: ${entry.name}. Score: ${entry.score}, Time: ${t}`;
                leaderboardElement.appendChild(li);
            });
        };

        // Listen for updated leaderboard data from the server
        socket.on('leaderboard', (data) => {
            updateLeaderboard(data);
        });

      
        
    </script>
</body>
</html>
